---
import type { GetStaticPaths } from 'astro';
import BlogPostSingle from '../../layouts/BlogPostSingle.astro';
import SingleBlogPage from './SingleBlogPage.astro';
import qs from 'qs'

export async function getStaticPaths() {
  let url = import.meta.env.STRAPI_URL + "/api/posts";

  const query = qs.stringify({
  populate: {
    featuredImage: {
      fields: ["name", "width", "height", "url"],
    },
    author: {
      populate: {
        bioImage: {
          fields: ["name", "width", "height", "url"],
        },
      },
    },
    category: {
      populate: true,
    },
  },
});

  const data = await fetch(url + "?" + query).then(response => response.json());
  return data.data.map((post) => {
    return {
      params: { slug: post.attributes.slug },
      props: { post },
    };
  }) satisfies GetStaticPaths
}
const { slug } = Astro.params
const {post} =Astro.props
---

<BlogPostSingle layout={post}>
  <SingleBlogPage post={post}/>
</BlogPostSingle> 
